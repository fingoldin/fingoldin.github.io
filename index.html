<!DOCTYPE html>

<head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="/jsPsych/jspsych.js"></script>
<script src="/jsPsych/plugins/jspsych-text.js"></script>
<script src="/jsPsych/plugins/jspsych-html.js"></script>
<script src="/jsPsych/plugins/jspsych-animation.js"></script>
<script src="/jsPsych/plugins/jspsych-number-animation.js"></script>
<script src="/jsPsych/plugins/jspsych-html-animation.js"></script>
<script src="/jsPsych/plugins/jspsych-bar-choose.js"></script>
<script src="/jsPsych/plugins/jspsych-ticket-choose.js"></script>
<script src="/utils/general.js"></script>
<script src="/utils/bar-choose-plugin.js"></script>
<script src="/utils/jquery.transform2d.js"></script>
<link href="/jsPsych/css/jspsych.css" rel="stylesheet" type="text/css"></link>
<link href="/utils/general.css" rel="stylesheet" type="text/css"></link>
<link href="/utils/bar-choose-plugin.css" rel="stylesheet" type="text/css"></link>
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
<link href="/utils/consent.css" rel="stylesheet" type="text/css"></link>
<link href="/utils/start.css" rel="stylesheet" type="text/css"></link>
<link href="/utils/points.css" rel="stylesheet" type="text/css"></link>

<script type="text/javascript">

var points_counter = {
	p: 0
}

var consent_trial = {
	type: "html",	
	url: "/utils/consent.html",
	cont_btn: "agree2"
}

var instructions_trial = {
	type: "html",
	url: "/utils/instructions.html",
	cont_btn: "continue1"
}

var start_trial = {
	type: "html",
	url: "/utils/start.html",
	cont_btn: "start1"
}

var animdata = [98, 91, 101, 107, 107, 92, 98, 107];//, 109, 108, 101, 101, 104, 89, 101, 96, 100, 97, 106, 97, 96, 96, 98, 96, 106, 101, 105, 98, 96, 95, 101, 97, 97, 95, 102, 89, 103, 95, 108, 95, 97, 101, 111, 106, 107, 106, 101, 100, 109, 107];
var animanswers = [1, 3, 5, 5, 3, 1];

var animation_trial = {
	type: "number-animation",
	prices: animdata,
	continue_message: "Next step"
}

var training_trial = {
	type: "bar-choose",
	instructions: "Now let's imagine you would see 20 more tickets for your trip to Canada.",
	subtitle: "Please drag the bar or type in the input field to determine the amount of tickets that are in the equivalent price range for this trip. <br><br>Press continue when you are sure of your answers.",
	categories: ["$85 - $90", "$90 - $95", "$95 - $100", "$100 - $105", "$105 - $110", "$110 - $115"],
	min_val: 0,
	max_val: 20,
	answers: animanswers
}

var testing_data = [
[105, 95, 101, 102, 98, 94, 106, 107, 103, 100]];
/*,
[107, 94, 100, 103, 96, 89, 108, 115, 105, 97],
[105, 97, 102, 103, 99, 95, 108, 110, 104, 100],
[104, 94, 98, 102, 95, 90, 107, 114, 103, 96],
[105, 96, 101, 102, 98, 94, 107, 109, 103, 100],
[92, 93, 96, 99, 104, 95, 106, 100, 110, 111],
[91, 92, 95, 97, 100, 93, 102, 98, 103, 104],
[91, 95, 97, 98, 101, 96, 102, 100, 103, 110],
[94, 96, 99, 100, 103, 97, 105, 101, 108, 112],
[93, 95, 97, 98, 102, 96, 103, 100, 104, 105],
[108, 114, 107, 105, 104, 99, 97, 103, 88, 90],
[106, 108, 105, 104, 101, 95, 94, 100, 92, 93],
[110, 111, 109, 108, 104, 100, 99, 102, 92, 98],
[106, 107, 103, 102, 101, 95, 94, 97, 92, 93],
[102, 112, 101, 100, 99, 96, 95, 97, 91, 92],
[93, 107, 95, 103, 94, 113, 96, 101, 98, 97],
[91, 104, 94, 101, 93, 109, 97, 100, 99, 98],
[89, 103, 91, 102, 90, 104, 94, 101, 100, 98],
[86, 106, 93, 102, 90, 108, 94, 99, 96, 95],
[84, 106, 90, 105, 87, 112, 96, 103, 102, 100],
[102, 101, 98, 96, 100, 97, 99, 94, 88, 95],
[101, 102, 98, 96, 100, 97, 99, 94, 88, 95],
[101, 98, 102, 96, 100, 97, 99, 94, 88, 95],
[101, 98, 96, 102, 100, 97, 99, 94, 88, 95],
[101, 98, 96, 100, 102, 97, 99, 94, 88, 95],
[106, 96, 102, 103, 99, 95, 107, 108, 104, 101],
[108, 95, 101, 104, 97, 90, 109, 116, 106, 98],
[106, 98, 103, 104, 100, 96, 109, 111, 105, 101],
[105, 95, 99, 103, 96, 91, 108, 115, 104, 97],
[106, 97, 102, 103, 99, 95, 108, 110, 104, 101],
[93, 94, 97, 100, 105, 96, 107, 101, 111, 112],
[92, 93, 96, 98, 101, 94, 103, 99, 104, 105],
[92, 96, 98, 99, 102, 97, 103, 101, 104, 111],
[95, 97, 100, 101, 104, 98, 106, 102, 109, 113],
[94, 96, 98, 99, 103, 97, 104, 101, 105, 106],
[109, 115, 108, 106, 105, 100, 98, 104, 89, 91],
[107, 109, 106, 105, 102, 96, 95, 101, 93, 94],
[111, 112, 110, 109, 105, 101, 100, 103, 93, 99],
[107, 108, 104, 103, 102, 96, 95, 98, 93, 94],
[103, 113, 102, 101, 100, 97, 96, 98, 92, 93],
[94, 108, 96, 104, 95, 114, 97, 102, 99, 98],
[92, 105, 95, 102, 94, 110, 98, 101, 100, 99],
[90, 104, 92, 103, 91, 105, 95, 102, 101, 99],
[87, 107, 94, 103, 91, 109, 95, 100, 97, 96],
[85, 107, 91, 106, 88, 113, 97, 104, 103, 101],
[103, 102, 99, 97, 101, 98, 100, 95, 89, 96],
[102, 103, 99, 97, 101, 98, 100, 95, 89, 96],
[102, 99, 103, 97, 101, 98, 100, 95, 89, 96],
[102, 99, 97, 103, 101, 98, 100, 95, 89, 96],
[102, 99, 97, 101, 103, 98, 100, 95, 89, 96]];*/

var testing_instructions_trial = {
	type: "html",
        url: "/utils/testing.html",
        cont_btn: "testingstart"
}

// Second testing instructions (after example sequence)
var testing_instructions2_trial = {
	type: "html",
	url: "/utils/testing_after.html",
	cont_btn: "testingstart",
	on_finish: function() { $("#jspsych-points").css("opacity", "1"); }
}

// Second bar graph to see learning
var training_trial2 = {
	type: "bar-choose",
        instructions: "Insert new instructions here",
        subtitle: "Please drag the bar or type in the input field to determine the amount of tickets that are in the equivalent price range for this trip. Press continue when you are sure of your answers.",
        categories: ["$85 - $90", "$90 - $95", "$95 - $100", "$100 - $105", "$105 - $110", "$110 - $115"],
        min_val: 0,
        max_val: 20,
	answers: animanswers
}

// Second training phase instructions
var p2_start_trial = {
	type: "html",
	url: "/utils/start2.html",
	cont_btn: "start2"
}

var animdata2 = [98, 91, 101, 107, 107, 92, 98, 107];//, 109, 108, 101, 101, 104, 89, 101, 96, 100, 9];
var animanswers2 = [4, 5, 6, 7, 5, 4];

// Second training phase
var p2_animation_trial = {
        type: "number-animation",
        prices: animdata2,
        continue_message: "Next step"
}

var p2_training_trial = {
        type: "bar-choose",
        instructions: "Now let's imagine you would see 20 more tickets for your trip to Alaska.",
        subtitle: "Please drag the bar or type in the input field to determine the amount of tickets that are in the equivalent price range for this trip. Press continue when you are sure of your answers.",
        categories: ["$85 - $90", "$90 - $95", "$95 - $100", "$100 - $105", "$105 - $110", "$110 - $115"],
        min_val: 0,
        max_val: 20,
	answers: animanswers2
}

var p2_testing_data = [
[105, 95, 101, 102, 98, 94, 106, 107, 103, 100],
[107, 94, 100, 103, 96, 89, 108, 115, 105, 97],
[105, 97, 102, 103, 99, 95, 108, 110, 104, 100],
[104, 94, 98, 102, 95, 90, 107, 114, 103, 96],
[105, 96, 101, 102, 98, 94, 107, 109, 103, 100],
[92, 93, 96, 99, 104, 95, 106, 100, 110, 111],
[91, 92, 95, 97, 100, 93, 102, 98, 103, 104],
[91, 95, 97, 98, 101, 96, 102, 100, 103, 110],
[94, 96, 99, 100, 103, 97, 105, 101, 108, 112],
[93, 95, 97, 98, 102, 96, 103, 100, 104, 105],
[108, 114, 107, 105, 104, 99, 97, 103, 88, 90],
[106, 108, 105, 104, 101, 95, 94, 100, 92, 93],
[110, 111, 109, 108, 104, 100, 99, 102, 92, 98],
[106, 107, 103, 102, 101, 95, 94, 97, 92, 93],
[102, 112, 101, 100, 99, 96, 95, 97, 91, 92],
[93, 107, 95, 103, 94, 113, 96, 101, 98, 97],
[91, 104, 94, 101, 93, 109, 97, 100, 99, 98],
[89, 103, 91, 102, 90, 104, 94, 101, 100, 98],
[86, 106, 93, 102, 90, 108, 94, 99, 96, 95],
[84, 106, 90, 105, 87, 112, 96, 103, 102, 100],
[102, 101, 98, 96, 100, 97, 99, 94, 88, 95],
[101, 102, 98, 96, 100, 97, 99, 94, 88, 95],
[101, 98, 102, 96, 100, 97, 99, 94, 88, 95],
[101, 98, 96, 102, 100, 97, 99, 94, 88, 95],
[101, 98, 96, 100, 102, 97, 99, 94, 88, 95],
[106, 96, 102, 103, 99, 95, 107, 108, 104, 101],
[108, 95, 101, 104, 97, 90, 109, 116, 106, 98],
[106, 98, 103, 104, 100, 96, 109, 111, 105, 101],
[105, 95, 99, 103, 96, 91, 108, 115, 104, 97],
[106, 97, 102, 103, 99, 95, 108, 110, 104, 101],
[93, 94, 97, 100, 105, 96, 107, 101, 111, 112],
[92, 93, 96, 98, 101, 94, 103, 99, 104, 105],
[92, 96, 98, 99, 102, 97, 103, 101, 104, 111],
[95, 97, 100, 101, 104, 98, 106, 102, 109, 113],
[94, 96, 98, 99, 103, 97, 104, 101, 105, 106],
[109, 115, 108, 106, 105, 100, 98, 104, 89, 91],
[107, 109, 106, 105, 102, 96, 95, 101, 93, 94],
[111, 112, 110, 109, 105, 101, 100, 103, 93, 99],
[107, 108, 104, 103, 102, 96, 95, 98, 93, 94],
[103, 113, 102, 101, 100, 97, 96, 98, 92, 93],
[94, 108, 96, 104, 95, 114, 97, 102, 99, 98],
[92, 105, 95, 102, 94, 110, 98, 101, 100, 99],
[90, 104, 92, 103, 91, 105, 95, 102, 101, 99],
[87, 107, 94, 103, 91, 109, 95, 100, 97, 96],
[85, 107, 91, 106, 88, 113, 97, 104, 103, 101],
[103, 102, 99, 97, 101, 98, 100, 95, 89, 96],
[102, 103, 99, 97, 101, 98, 100, 95, 89, 96],
[102, 99, 103, 97, 101, 98, 100, 95, 89, 96],
[102, 99, 97, 103, 101, 98, 100, 95, 89, 96],
[102, 99, 97, 101, 103, 98, 100, 95, 89, 96]];

var p2_testing_instructions_trial = {
        type: "html",
        url: "/utils/testing2.html",
        cont_btn: "testingstart",
	on_finish: function() { $("#jspsych-points").css("opacity", "1"); }
}

// Second bar graph to see learning
var p2_training_trial2 = {
        type: "bar-choose",
        instructions: "Insert new instructions here",
        subtitle: "Please drag the bar or type in the input field to determine the amount of tickets that are in the equivalent price range for this trip. Press continue when you are sure of your answers.",
        categories: ["$85 - $90", "$90 - $95", "$95 - $100", "$100 - $105", "$105 - $110", "$110 - $115"],
        min_val: 0,
        max_val: 20,
	answers: animanswers2
}

var TICKET_IMAGES = [];
function preload()
{
	for(var i = 0; i < NUM_TICKETS; i++)
	{
		TICKET_IMAGES[i] = new Image();
		TICKET_IMAGES[i].src = "/utils/tickets/ticket" + (i+1) + ".jpg";
		TICKET_IMAGES[i].classList.add("ticket-img");
		console.log("loaded " + (i+1));
	}
}

preload();

function init()
{
	var timeline = [];

	timeline.push(consent_trial);
        timeline.push(instructions_trial);
        timeline.push(start_trial);
        timeline.push(animation_trial);
        timeline.push(training_trial);
        timeline.push(testing_instructions_trial);

	// example testing sequence
	timeline.push({ type: "ticket-choose",
			prices: [106, 97, 102, 103, 99, 95, 108, 110, 104, 101],
			continue_mesage: "Finish",
			sequence: ""
	});

	timeline.push(testing_instructions2_trial);

	for(var i = 0; i < testing_data.length; i++)
	{
        	timeline.push({ type: "ticket-choose",
               	                prices: testing_data[i], 
                       	        continue_message: "Next sequence",
				sequence: "In sequence <span>" + (i + 1) + "</span> out of <span>" + testing_data.length + "</span>",
			//	points: function() { return points_counter; },
				showpoints: true,
				on_finish: function(data) {
                                	points_counter.p += data.points;
                               		console.log(points_counter.p);
					$("#points-p").html(points_counter.p);
				}
		});
	}
	timeline[timeline.length-1].continue_message = "Finish";
	timeline[timeline.length-1].on_finish = function() { $("#jspsych-points").css("opacity", "0"); };

	timeline.push(training_trial2);

	timeline.push(p2_start_trial);
        timeline.push(p2_animation_trial);
        timeline.push(p2_training_trial);
        timeline.push(p2_testing_instructions_trial);

	for(var i = 0; i < p2_testing_data.length; i++)
        {
                timeline.push({ type: "ticket-choose",
                                prices: p2_testing_data[i], 
                                continue_message: "Next sequence",
                                sequence: "In sequence <span>" + (i + 1) + "</span> out of <span>" + p2_testing_data.length + "</span>",
                        //      points: function() { return points_counter; },
                                showpoints: true,
                                on_finish: function(data) {
                                        points_counter.p += data.points;
                                        console.log(points_counter.p);
                                        $("#points-p").html(points_counter.p);
                                }
                });
        }
        timeline[timeline.length-1].continue_message = "Finish";

	timeline.push(p2_training_trial2);

	$("#wheel").css("display", "none");

	jsPsych.init({
		timeline: timeline,
		display_element: $("#jspsych-main")
	});
}

</script>

</head>

<body onload="init()">
	<div class="wheel-loader" id="wheel"></div>
	<div id="jspsych-points" style="opacity:0">
		<div class="points-main">
        		<div class="points-header">
               			<h2>Your Points:</h2>
        		</div>
                	<div class="points-points">
                       		<h2 id="points-p">0</h2>
                	</div>
                	<div class="points-subtitle">
                       		<p id="points-s"></p>
                	</div>
		</div>
	</div>
	<div id="jspsych-main"></div>
</body>

</html>
